FROM python:3.10-slim

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    ENVIRONMENT=development

RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

RUN pip install --no-cache-dir --upgrade pip setuptools wheel

COPY backend/requirements_all.txt requirements_all.txt
RUN pip install --no-cache-dir -r requirements_all.txt

# Copy all backend services (volumes override in docker-compose for hot reload)
COPY backend/api-gateway/ api-gateway/
COPY backend/stt-service/ stt-service/
COPY backend/llm-service/ llm-service/
COPY backend/tts-service/ tts-service/
